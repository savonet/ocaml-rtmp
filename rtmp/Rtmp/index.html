<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Rtmp (rtmp.Rtmp)</title><link rel="stylesheet" href="../../odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 2.0.2"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../index.html">rtmp</a> &#x00BB; Rtmp</nav><header class="odoc-preamble"><h1>Module <code><span>Rtmp</span></code></h1></header><div class="odoc-content"><div class="odoc-spec"><div class="spec module" id="module-Io" class="anchored"><a href="#module-Io" class="anchor"></a><code><span><span class="keyword">module</span> </span><span><a href="Io/index.html">Io</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>I/O helper functions.</p></div></div><div class="odoc-spec"><div class="spec module" id="module-Flv" class="anchored"><a href="#module-Flv" class="anchor"></a><code><span><span class="keyword">module</span> </span><span><a href="Flv/index.html">Flv</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>Operations on flv files.</p></div></div><div class="odoc-spec"><div class="spec module" id="module-Amf" class="anchored"><a href="#module-Amf" class="anchor"></a><code><span><span class="keyword">module</span> </span><span><a href="Amf/index.html">Amf</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>AMF0</p></div></div><div class="odoc-spec"><div class="spec exception" id="exception-Connection_closed" class="anchored"><a href="#exception-Connection_closed" class="anchor"></a><code><span><span class="keyword">exception</span> </span><span><span class="exception">Connection_closed</span></span></code></div></div><p>Low-level functions.</p><div class="odoc-spec"><div class="spec value" id="val-basic_header" class="anchored"><a href="#val-basic_header" class="anchor"></a><code><span><span class="keyword">val</span> basic_header : <span><span class="xref-unresolved">Unix</span>.file_descr <span class="arrow">&#45;&gt;</span></span> <span>chunk_type:int <span class="arrow">&#45;&gt;</span></span> <span>chunk_stream_id:int <span class="arrow">&#45;&gt;</span></span> unit</span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-chunk_header0" class="anchored"><a href="#val-chunk_header0" class="anchor"></a><code><span><span class="keyword">val</span> chunk_header0 : <span><span class="xref-unresolved">Unix</span>.file_descr <span class="arrow">&#45;&gt;</span></span> <span>chunk_stream_id:int <span class="arrow">&#45;&gt;</span></span> <span>timestamp:int32 <span class="arrow">&#45;&gt;</span></span>
<span>message_length:int <span class="arrow">&#45;&gt;</span></span> <span>message_type_id:int <span class="arrow">&#45;&gt;</span></span> <span>message_stream_id:int32 <span class="arrow">&#45;&gt;</span></span> unit</span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-chunk_header1" class="anchored"><a href="#val-chunk_header1" class="anchor"></a><code><span><span class="keyword">val</span> chunk_header1 : <span><span class="xref-unresolved">Unix</span>.file_descr <span class="arrow">&#45;&gt;</span></span> <span>chunk_stream_id:int <span class="arrow">&#45;&gt;</span></span> <span>timestamp_delta:int32 <span class="arrow">&#45;&gt;</span></span>
<span>message_length:int <span class="arrow">&#45;&gt;</span></span> <span>message_type_id:int <span class="arrow">&#45;&gt;</span></span> unit</span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-chunk_header2" class="anchored"><a href="#val-chunk_header2" class="anchor"></a><code><span><span class="keyword">val</span> chunk_header2 : <span><span class="xref-unresolved">Unix</span>.file_descr <span class="arrow">&#45;&gt;</span></span> <span>chunk_stream_id:int <span class="arrow">&#45;&gt;</span></span> <span>timestamp_delta:int32 <span class="arrow">&#45;&gt;</span></span>
unit</span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-chunk_header3" class="anchored"><a href="#val-chunk_header3" class="anchor"></a><code><span><span class="keyword">val</span> chunk_header3 : <span><span class="xref-unresolved">Unix</span>.file_descr <span class="arrow">&#45;&gt;</span></span> <span>chunk_stream_id:int <span class="arrow">&#45;&gt;</span></span> unit</span></code></div></div><p>High-level functions.</p><div class="odoc-spec"><div class="spec module" id="module-Message" class="anchored"><a href="#module-Message" class="anchor"></a><code><span><span class="keyword">module</span> </span><span><a href="Message/index.html">Message</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div></div><div class="odoc-spec"><div class="spec module" id="module-IMap" class="anchored"><a href="#module-IMap" class="anchor"></a><code><span><span class="keyword">module</span> </span><span><a href="IMap/index.html">IMap</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div></div><div class="odoc-spec"><div class="spec type" id="type-connection" class="anchored"><a href="#type-connection" class="anchor"></a><code><span><span class="keyword">type</span> connection</span><span> = </span><span>{</span></code><table><tr id="type-connection.start_time" class="anchored"><td class="def record field"><a href="#type-connection.start_time" class="anchor"></a><code><span><span class="keyword">mutable</span> start_time : float;</span></code></td></tr><tr id="type-connection.last_time" class="anchored"><td class="def record field"><a href="#type-connection.last_time" class="anchor"></a><code><span><span class="keyword">mutable</span> last_time : float;</span></code></td></tr><tr id="type-connection.socket" class="anchored"><td class="def record field"><a href="#type-connection.socket" class="anchor"></a><code><span>socket : <span class="xref-unresolved">Unix</span>.file_descr;</span></code></td></tr><tr id="type-connection.chunk_size" class="anchored"><td class="def record field"><a href="#type-connection.chunk_size" class="anchor"></a><code><span><span class="keyword">mutable</span> chunk_size : int;</span></code></td></tr><tr id="type-connection.last_timestamp" class="anchored"><td class="def record field"><a href="#type-connection.last_timestamp" class="anchor"></a><code><span><span class="keyword">mutable</span> last_timestamp : <span><span class="xref-unresolved">Stdlib</span>.Int32.t <a href="IMap/index.html#type-t">IMap.t</a></span>;</span></code></td></tr><tr id="type-connection.last_message_length" class="anchored"><td class="def record field"><a href="#type-connection.last_message_length" class="anchor"></a><code><span><span class="keyword">mutable</span> last_message_length : <span>int <a href="IMap/index.html#type-t">IMap.t</a></span>;</span></code></td></tr><tr id="type-connection.last_message_stream_id" class="anchored"><td class="def record field"><a href="#type-connection.last_message_stream_id" class="anchor"></a><code><span><span class="keyword">mutable</span> last_message_stream_id : <span><span class="xref-unresolved">Stdlib</span>.Int32.t <a href="IMap/index.html#type-t">IMap.t</a></span>;</span></code></td></tr><tr id="type-connection.last_message_type_id" class="anchored"><td class="def record field"><a href="#type-connection.last_message_type_id" class="anchor"></a><code><span><span class="keyword">mutable</span> last_message_type_id : <span>int <a href="IMap/index.html#type-t">IMap.t</a></span>;</span></code></td></tr><tr id="type-connection.partial_messages" class="anchored"><td class="def record field"><a href="#type-connection.partial_messages" class="anchor"></a><code><span><span class="keyword">mutable</span> partial_messages : <span><a href="Message/index.html#type-t">Message.t</a> list</span>;</span></code></td></tr><tr id="type-connection.messages" class="anchored"><td class="def record field"><a href="#type-connection.messages" class="anchor"></a><code><span>messages : <span><a href="Message/index.html#type-t">Message.t</a> <span class="xref-unresolved">Stdlib</span>.Queue.t</span>;</span></code></td></tr></table><code><span>}</span></code></div><div class="spec-doc"><p>Parameters for a given connection.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-create_connection" class="anchored"><a href="#val-create_connection" class="anchor"></a><code><span><span class="keyword">val</span> create_connection : <span><span class="xref-unresolved">Unix</span>.file_descr <span class="arrow">&#45;&gt;</span></span> <a href="#type-connection">connection</a></span></code></div><div class="spec-doc"><p>Create a connection.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-now" class="anchored"><a href="#val-now" class="anchor"></a><code><span><span class="keyword">val</span> now : <span><a href="#type-connection">connection</a> <span class="arrow">&#45;&gt;</span></span> int32</span></code></div><div class="spec-doc"><p>Current timestamp.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-delta" class="anchored"><a href="#val-delta" class="anchor"></a><code><span><span class="keyword">val</span> delta : <span><a href="#type-connection">connection</a> <span class="arrow">&#45;&gt;</span></span> int32</span></code></div><div class="spec-doc"><p>Current timestamp delta.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-chunkify" class="anchored"><a href="#val-chunkify" class="anchor"></a><code><span><span class="keyword">val</span> chunkify : <span><a href="#type-connection">connection</a> <span class="arrow">&#45;&gt;</span></span> <span>chunk_stream_id:int <span class="arrow">&#45;&gt;</span></span> <span>timestamp:int32 <span class="arrow">&#45;&gt;</span></span> <span>message_type_id:int <span class="arrow">&#45;&gt;</span></span>
<span>message_stream_id:int32 <span class="arrow">&#45;&gt;</span></span> <span>string <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Write a long message with chunks.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-control_message" class="anchored"><a href="#val-control_message" class="anchor"></a><code><span><span class="keyword">val</span> control_message : <span><a href="#type-connection">connection</a> <span class="arrow">&#45;&gt;</span></span> <span>int <span class="arrow">&#45;&gt;</span></span> <span>string <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Send a control message.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-set_chunk_size" class="anchored"><a href="#val-set_chunk_size" class="anchor"></a><code><span><span class="keyword">val</span> set_chunk_size : <span><a href="#type-connection">connection</a> <span class="arrow">&#45;&gt;</span></span> <span>int <span class="arrow">&#45;&gt;</span></span> unit</span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-abort_message" class="anchored"><a href="#val-abort_message" class="anchor"></a><code><span><span class="keyword">val</span> abort_message : <span><a href="#type-connection">connection</a> <span class="arrow">&#45;&gt;</span></span> <span>int32 <span class="arrow">&#45;&gt;</span></span> unit</span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-acknowledgement" class="anchored"><a href="#val-acknowledgement" class="anchor"></a><code><span><span class="keyword">val</span> acknowledgement : <span><a href="#type-connection">connection</a> <span class="arrow">&#45;&gt;</span></span> <span>int32 <span class="arrow">&#45;&gt;</span></span> unit</span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-user_control" class="anchored"><a href="#val-user_control" class="anchor"></a><code><span><span class="keyword">val</span> user_control : <span><a href="#type-connection">connection</a> <span class="arrow">&#45;&gt;</span></span> <span>int <span class="arrow">&#45;&gt;</span></span> <span>string <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Send a user control message.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-stream_begin" class="anchored"><a href="#val-stream_begin" class="anchor"></a><code><span><span class="keyword">val</span> stream_begin : <span><a href="#type-connection">connection</a> <span class="arrow">&#45;&gt;</span></span> <span>int32 <span class="arrow">&#45;&gt;</span></span> unit</span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-ping_request" class="anchored"><a href="#val-ping_request" class="anchor"></a><code><span><span class="keyword">val</span> ping_request : <span><a href="#type-connection">connection</a> <span class="arrow">&#45;&gt;</span></span> <span>int32 <span class="arrow">&#45;&gt;</span></span> unit</span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-ping_response" class="anchored"><a href="#val-ping_response" class="anchor"></a><code><span><span class="keyword">val</span> ping_response : <span><a href="#type-connection">connection</a> <span class="arrow">&#45;&gt;</span></span> <span>int32 <span class="arrow">&#45;&gt;</span></span> unit</span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-window_acknowledgement_size" class="anchored"><a href="#val-window_acknowledgement_size" class="anchor"></a><code><span><span class="keyword">val</span> window_acknowledgement_size : <span><a href="#type-connection">connection</a> <span class="arrow">&#45;&gt;</span></span> <span>int <span class="arrow">&#45;&gt;</span></span> unit</span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-set_peer_bandwidth" class="anchored"><a href="#val-set_peer_bandwidth" class="anchor"></a><code><span><span class="keyword">val</span> set_peer_bandwidth : <span><a href="#type-connection">connection</a> <span class="arrow">&#45;&gt;</span></span> <span>int <span class="arrow">&#45;&gt;</span></span> <span><span>[&lt; `Dynamic <span>| `Hard</span> <span>| `Soft</span> ]</span> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-command" class="anchored"><a href="#val-command" class="anchor"></a><code><span><span class="keyword">val</span> command : <span><a href="#type-connection">connection</a> <span class="arrow">&#45;&gt;</span></span> <span>?timestamp:int32 <span class="arrow">&#45;&gt;</span></span> <span>?message_stream_id:int32 <span class="arrow">&#45;&gt;</span></span>
<span>string <span class="arrow">&#45;&gt;</span></span> <span>int <span class="arrow">&#45;&gt;</span></span> <span><span><a href="Amf/index.html#type-t">Amf.t</a> list</span> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-audio" class="anchored"><a href="#val-audio" class="anchor"></a><code><span><span class="keyword">val</span> audio : <span><a href="#type-connection">connection</a> <span class="arrow">&#45;&gt;</span></span> <span>?timestamp:int32 <span class="arrow">&#45;&gt;</span></span> <span>?message_stream_id:int32 <span class="arrow">&#45;&gt;</span></span> <span>string <span class="arrow">&#45;&gt;</span></span> unit</span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-video" class="anchored"><a href="#val-video" class="anchor"></a><code><span><span class="keyword">val</span> video : <span><a href="#type-connection">connection</a> <span class="arrow">&#45;&gt;</span></span> <span>?timestamp:int32 <span class="arrow">&#45;&gt;</span></span> <span>?message_stream_id:int32 <span class="arrow">&#45;&gt;</span></span> <span>string <span class="arrow">&#45;&gt;</span></span> unit</span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-data" class="anchored"><a href="#val-data" class="anchor"></a><code><span><span class="keyword">val</span> data : <span><a href="#type-connection">connection</a> <span class="arrow">&#45;&gt;</span></span> <span>?message_stream_id:int32 <span class="arrow">&#45;&gt;</span></span> <span><span><a href="Amf/index.html#type-t">Amf.t</a> list</span> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-handshake" class="anchored"><a href="#val-handshake" class="anchor"></a><code><span><span class="keyword">val</span> handshake : <span><a href="#type-connection">connection</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Perform handshake.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-read_chunk" class="anchored"><a href="#val-read_chunk" class="anchor"></a><code><span><span class="keyword">val</span> read_chunk : <span><a href="#type-connection">connection</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Read a chunk.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-has_message" class="anchored"><a href="#val-has_message" class="anchor"></a><code><span><span class="keyword">val</span> has_message : <span><a href="#type-connection">connection</a> <span class="arrow">&#45;&gt;</span></span> bool</span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-pop_message" class="anchored"><a href="#val-pop_message" class="anchor"></a><code><span><span class="keyword">val</span> pop_message : <span><a href="#type-connection">connection</a> <span class="arrow">&#45;&gt;</span></span> <span class="xref-unresolved">Stdlib</span>.Int32.t * <span class="xref-unresolved">Stdlib</span>.Int32.t * <span>[&gt; <span>`Acknowledgement of int32</span> <span><span>| `Audio</span> of string</span> <span><span>| `Command</span> of int * <span>[&gt; `Connect <span>| `Create_stream</span> <span><span>| `Delete_stream</span> of int</span> <span>| `On_bandwidth_done</span> <span><span>| `On_status</span> of <a href="Amf/index.html#type-t">Amf.t</a></span> <span><span>| `Publish</span> of string * string</span> <span><span>| `Result</span> of <span><a href="Amf/index.html#type-t">Amf.t</a> array</span></span> <span><span>| `Unhandled</span> of string * <span><a href="Amf/index.html#type-t">Amf.t</a> array</span></span> ]</span></span> <span><span>| `Data</span> of <span><a href="Amf/index.html#type-t">Amf.t</a> list</span></span> <span><span>| `Peer_banddwidth</span> of int32 * <span>[&gt; `Dynamic <span>| `Hard</span> <span>| `Soft</span> ]</span></span> <span><span>| `Set_chunk_size</span> of int</span> <span><span>| `Video</span> of string</span> <span><span>| `Window_acknowledgement_size</span> of int32</span> ]</span></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-handle_messages" class="anchored"><a href="#val-handle_messages" class="anchor"></a><code><span><span class="keyword">val</span> handle_messages : <span><a href="#type-connection">connection</a> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span>timestamp:<span class="xref-unresolved">Stdlib</span>.Int32.t <span class="arrow">&#45;&gt;</span></span> <span>stream:<span class="xref-unresolved">Stdlib</span>.Int32.t <span class="arrow">&#45;&gt;</span></span>
<span><span>[&gt; <span>`Acknowledgement of int32</span> <span><span>| `Audio</span> of string</span> <span><span>| `Command</span> of int * <span>[&gt; `Connect <span>| `Create_stream</span> <span><span>| `Delete_stream</span> of int</span> <span>| `On_bandwidth_done</span> <span><span>| `On_status</span> of <a href="Amf/index.html#type-t">Amf.t</a></span> <span><span>| `Publish</span> of string * string</span> <span><span>| `Result</span> of <span><a href="Amf/index.html#type-t">Amf.t</a> array</span></span> <span><span>| `Unhandled</span> of string * <span><a href="Amf/index.html#type-t">Amf.t</a> array</span></span> ]</span></span> <span><span>| `Data</span> of <span><a href="Amf/index.html#type-t">Amf.t</a> list</span></span> <span><span>| `Peer_banddwidth</span> of int32 * <span>[&gt; `Dynamic <span>| `Hard</span> <span>| `Soft</span> ]</span></span> <span><span>| `Set_chunk_size</span> of int</span> <span><span>| `Video</span> of string</span> <span><span>| `Window_acknowledgement_size</span> of int32</span> ]</span> <span class="arrow">&#45;&gt;</span></span> unit)</span> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Pass all available messages to a function.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-read_chunks" class="anchored"><a href="#val-read_chunks" class="anchor"></a><code><span><span class="keyword">val</span> read_chunks : <span>?handler:<span>(<span>timestamp:<span class="xref-unresolved">Stdlib</span>.Int32.t <span class="arrow">&#45;&gt;</span></span> <span>stream:<span class="xref-unresolved">Stdlib</span>.Int32.t <span class="arrow">&#45;&gt;</span></span>
<span><span>[&gt; <span>`Acknowledgement of int32</span> <span><span>| `Audio</span> of string</span> <span><span>| `Command</span> of int * <span>[&gt; `Connect <span>| `Create_stream</span> <span><span>| `Delete_stream</span> of int</span> <span>| `On_bandwidth_done</span> <span><span>| `On_status</span> of <a href="Amf/index.html#type-t">Amf.t</a></span> <span><span>| `Publish</span> of string * string</span> <span><span>| `Result</span> of <span><a href="Amf/index.html#type-t">Amf.t</a> array</span></span> <span><span>| `Unhandled</span> of string * <span><a href="Amf/index.html#type-t">Amf.t</a> array</span></span> ]</span></span> <span><span>| `Data</span> of <span><a href="Amf/index.html#type-t">Amf.t</a> list</span></span> <span><span>| `Peer_banddwidth</span> of int32 * <span>[&gt; `Dynamic <span>| `Hard</span> <span>| `Soft</span> ]</span></span> <span><span>| `Set_chunk_size</span> of int</span> <span><span>| `Video</span> of string</span> <span><span>| `Window_acknowledgement_size</span> of int32</span> ]</span> <span class="arrow">&#45;&gt;</span></span> unit)</span>
<span class="arrow">&#45;&gt;</span></span> <span><a href="#type-connection">connection</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Read as many chunks as available.</p></div></div></div></body></html>